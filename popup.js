document.addEventListener("DOMContentLoaded",(function(){function e(e,t){const n=e.results,c=document.getElementById("results-container");if(c.innerHTML="",0===n.length)return void(c.innerHTML='<div style="padding: 10px">Không tìm thấy kết quả nào.</div>');const i='\n            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">\n                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z" />\n            </svg>',l=document.createElement("div");l.className="header",l.innerHTML=`\n            <h2>\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">\n                    <path d="M5.625 3.75a2.625 2.625 0 1 0 0 5.25h12.75a2.625 2.625 0 0 0 0-5.25H5.625ZM3.75 11.25a.75.75 0 0 0 0 1.5h16.5a.75.75 0 0 0 0-1.5H3.75ZM3 15.75a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75ZM3.75 18.75a.75.75 0 0 0 0 1.5h16.5a.75.75 0 0 0 0-1.5H3.75Z" />\n                </svg>\n                SevNSERP Extractor\n            </h2>\n            <div class="btn-container">\n                <button class="btn copy-sites">${i} Sites</button>\n                <button class="btn copy-titles">${i} Title</button>\n                <button class="btn copy-urls">${i} Urls</button>\n            </div>\n        `,c.appendChild(l),document.querySelector(".btn.copy-sites").addEventListener("click",s),document.querySelector(".btn.copy-titles").addEventListener("click",r),document.querySelector(".btn.copy-urls").addEventListener("click",o);const d=document.createElement("div");d.className="options",d.innerHTML='\n            <div class="result-number">\n                <label><input type="radio" name="num-results" value="10" /> <span>10</span></label>\n            </div>\n        ',c.appendChild(d);const u=new URLSearchParams(new URL(t).search).get("num")||"10";document.querySelector(`input[name="num-results"][value="${u}"]`).checked=!0,document.querySelectorAll('input[name="num-results"]').forEach((e=>{e.addEventListener("change",(function(){const e=new URL(t),n=e.searchParams;n.set("num",this.value),n.set("start",0),e.search=n.toString(),a(e.toString())}))}));const m=document.createElement("div");m.className="results-section";const p=new URLSearchParams(new URL(t).search),h=parseInt(p.get("start"))||0;n.forEach(((e,t)=>{const n=(h>0?h-1:h)+t+1,a=document.createElement("div");a.className="result-item",a.innerHTML=`\n                <p><b>#${n}</b>: <a href="${new URL(e.url).origin}" target="_blank" class="result-site">${e.site}</a></p>\n                <a href="${e.url}" target="_blank" class="result-title">${e.title}</a>\n                <div class="result-url">${e.url}</div>\n            `,m.appendChild(a)})),c.appendChild(m)}function t(e){const t=document.createElement("div");t.className="pagination-container";const a=new URLSearchParams(new URL(e).search),s=parseInt(a.get("num"))||10,r=parseInt(a.get("start"))||0,o=Math.floor(r/s)+1,c=document.querySelector(".pagination-container");if(c&&c.remove(),o>1){const a=document.createElement("button");a.className="btn-pagination prev",a.textContent="Prev",a.addEventListener("click",(()=>n(o-1,e))),t.appendChild(a)}const i=document.createElement("button");i.className="btn-pagination next",i.textContent="Next",i.addEventListener("click",(()=>n(o+1,e))),t.appendChild(i),document.getElementById("results-container").appendChild(t)}function n(e,t){const n=new URL(t),s=new URLSearchParams(n.search),r=parseInt(s.get("num"))||10;s.set("start",(e-1)*r),n.search=s.toString(),a(n.toString())}function a(n){chrome.tabs.update({url:n.toString()},(function(a){chrome.tabs.onUpdated.addListener((function s(r,o){r===a.id&&"complete"===o.status&&(chrome.tabs.sendMessage(r,{action:"extractSERPResults"},(function(a){a?(e(a,n.toString()),t(n.toString())):document.getElementById("results-container").innerHTML='<div style="padding: 10px">Hãy đảm bảo bạn đang ở trang kết quả tìm kiếm.</div>'})),chrome.tabs.onUpdated.removeListener(s))}))}))}function s(){c(Array.from(document.querySelectorAll(".result-item p")).map((e=>e.textContent.split(": ")[1].trim())).join("\n"),"Danh sách site")}function r(){c(Array.from(document.querySelectorAll(".result-title")).map((e=>e.textContent)).join("\n"),"Danh sách title")}function o(){c(Array.from(document.querySelectorAll(".result-url")).map((e=>e.textContent)).join("\n"),"Danh sách url")}function c(e,t){navigator.clipboard.writeText(e).then((function(){i(`${t} đã được sao chép!`)})).catch((function(e){i("Không thể sao chép vào clipboard: "+e)}))}function i(e){const t=document.createElement("div");t.className="toast",t.textContent=e,document.body.appendChild(t),setTimeout((()=>{t.classList.add("show")}),100),setTimeout((()=>{t.classList.remove("show"),document.body.removeChild(t)}),3e3)}chrome.tabs.query({active:!0,currentWindow:!0},(function(n){chrome.tabs.sendMessage(n[0].id,{action:"extractSERPResults"},(function(a){if(a)e(a,n[0].url),t(n[0].url);else{const r='\n                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 48 48">\n                            <path fill="#FFC107" d="M43.611 20.083H42V20H24v8h11.303c-1.649 4.657-6.08 8-11.303 8c-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C12.955 4 4 12.955 4 24s8.955 20 20 20s20-8.955 20-20c0-1.341-.138-2.65-.389-3.917z"/>\n                            <path fill="#FF3D00" d="m6.306 14.691l6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C16.318 4 9.656 8.337 6.306 14.691z"/>\n                            <path fill="#4CAF50" d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238A11.91 11.91 0 0 1 24 36c-5.202 0-9.619-3.317-11.283-7.946l-6.522 5.025C9.505 39.556 16.227 44 24 44z"/>\n                            <path fill="#1976D2" d="M43.611 20.083H42V20H24v8h11.303a12.04 12.04 0 0 1-4.087 5.571l.003-.002l6.19 5.238C36.971 39.205 44 34 44 24c0-1.341-.138-2.65-.389-3.917z"/>\n                        </svg>';function s(){const e=document.getElementById("search-input").value.trim(),t=document.getElementById("error-message");if(e){t.style.display="none";const n=`https://www.google.com/search?q=${encodeURIComponent(e)}`;chrome.tabs.create({url:n})}else t.style.display="block",t.textContent="Hãy nhập từ khóa trước khi tìm kiếm!"}document.getElementById("results-container").innerHTML=`\n                        <div>\n                            <h2 style="padding: 10px; background-color: var(--dark); color: var(--white)">Từ khoá tìm kiếm</h2>\n                            <div style="padding: 10px; display: flex; align-items: center; gap: 10px;">\n                                ${r}\n                                <input autofocus type="text" id="search-input" placeholder="Nhập từ khóa..." style="flex: 1; padding: 5px;" />\n                                <button id="search-button" style="padding: 5px; cursor: pointer;">Search</button>\n                            </div>\n                            <div id="error-message" style="padding:0 10px 10px; color: var(--primary); display: none;"></div>\n                        </div>\n                    `,document.getElementById("search-button").addEventListener("click",s),document.getElementById("search-input").addEventListener("keypress",(function(e){"Enter"===e.key&&(e.preventDefault(),s())}))}}))}))}));